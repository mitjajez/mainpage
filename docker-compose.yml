version: '3'
services:
  web:
    build: .
    command: "service nginx start; scripts/docker-wait-pgsql; python scripts/migrate.py; uwsgi --socket /var/tmp/nodewatcher.sock --wsgi-file /code/mainpage/wsgi.py --uid www-data --gid www-data"
    entrypoint: scripts/docker-run
    environment:
      PYTHONUNBUFFERED: 1
    volumes:
      - .:/code
    ports:
      - "80:80"
  db:
    image: tozd/postgresql:9.6
    environment:
      PGSQL_ROLE_1_USERNAME: wlansi_cms
      PGSQL_ROLE_1_PASSWORD: mainpage
      PGSQL_DB_1_NAME: wlansi
      PGSQL_DB_1_OWNER: wlansi_cms
    expose:
      - 5432/tcp
